# üìö HM_4 ‚Äî Scoring API

HTTP API —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–∫–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –û–û–ü –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏. API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞:
- `online_score` - —Ä–∞—Å—á–µ—Ç —Å–∫–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `clients_interests` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–µ–π (Field System)**
   - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `Field` - –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è: `CharField`, `EmailField`, `PhoneField`, `DateField`, etc.
   - –ö–∞–∂–¥–æ–µ –ø–æ–ª–µ –∑–Ω–∞–µ—Ç –∫–∞–∫ —Å–µ–±—è –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å

2. **–ú–µ—Ç–∞–∫–ª–∞—Å—Å RequestMeta**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ Field-–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∞—Å—Å–∞
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –∞—Ç—Ä–∏–±—É—Ç `_fields` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏

3. **–ö–ª–∞—Å—Å—ã –∑–∞–ø—Ä–æ—Å–æ–≤**
   - `MethodRequest` - –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
   - `OnlineScoreRequest` - –∑–∞–ø—Ä–æ—Å —Å–∫–æ—Ä–∏–Ω–≥–∞
   - `ClientsInterestsRequest` - –∑–∞–ø—Ä–æ—Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤

4. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–µ—Ç–æ–¥–æ–≤**
   - `online_score_handler` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞
   - `clients_interests_handler` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤

## üöÄ –ó–∞–ø—É—Å–∫

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
cd hm_4
uv sync --all-extras
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
# –ó–∞–ø—É—Å–∫ –Ω–∞ –ø–æ—Ä—Ç—É 8080 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
uv run python api.py

# –ó–∞–ø—É—Å–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ—Ä—Ç–∞ –∏ –ª–æ–≥-—Ñ–∞–π–ª–∞
uv run python api.py -p 8080 -l api.log
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
uv run python test.py

# –∏–ª–∏ —á–µ—Ä–µ–∑ pytest
uv run pytest test.py -v
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### Online Score
```bash
curl -X POST -H "Content-Type: application/json" -d '{
  "account": "horns&hoofs",
  "login": "h&f",
  "method": "online_score",
  "token": "55cc9ce545bcd144300fe9efc28e65d415b923ebb6be1e19d2750a2c03e80dd209a27954dca045e5bb12418e7d89b6d718a9e35af34e14e1d5bcd5a08f21fc95",
  "arguments": {
    "phone": "79175002040",
    "email": "test@example.ru",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "birthday": "01.01.1990",
    "gender": 1
  }
}' http://127.0.0.1:8080/method/
```

–û—Ç–≤–µ—Ç:
```json
{"code": 200, "response": {"score": 5.0}}
```

### Clients Interests
```bash
curl -X POST -H "Content-Type: application/json" -d '{
  "account": "horns&hoofs",
  "login": "h&f",
  "method": "clients_interests",
  "token": "55cc9ce545bcd144300fe9efc28e65d415b923ebb6be1e19d2750a2c03e80dd209a27954dca045e5bb12418e7d89b6d718a9e35af34e14e1d5bcd5a08f21fc95",
  "arguments": {
    "client_ids": [1, 2, 3, 4],
    "date": "20.07.2017"
  }
}' http://127.0.0.1:8080/method/
```

–û—Ç–≤–µ—Ç:
```json
{
  "code": 200,
  "response": {
    "1": ["books", "hi-tech"],
    "2": ["pets", "tv"],
    "3": ["travel", "music"],
    "4": ["cinema", "geek"]
  }
}
```

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–¢–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
- –î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: `SHA512(account + login + SALT)`
- –î–ª—è –∞–¥–º–∏–Ω–∞: `SHA512(—Ç–µ–∫—É—â–∏–π_—á–∞—Å + ADMIN_SALT)`

–ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞:
```python
import hashlib

# –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
account = "horns&hoofs"
login = "h&f"
SALT = "Otus"
token = hashlib.sha512((account + login + SALT).encode('utf-8')).hexdigest()

# –î–ª—è –∞–¥–º–∏–Ω–∞
import datetime
ADMIN_SALT = "42"
admin_token = hashlib.sha512(
    (datetime.datetime.now().strftime("%Y%m%d%H") + ADMIN_SALT).encode('utf-8')
).hexdigest()
```

## üìä –í–∞–ª–∏–¥–∞—Ü–∏—è

### –ü–æ–ª—è –∑–∞–ø—Ä–æ—Å–∞:
- **required** - –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
- **nullable** - –ø–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:
- **phone** - 11 —Ü–∏—Ñ—Ä, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7
- **email** - –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @
- **birthday** - —Ñ–æ—Ä–º–∞—Ç DD.MM.YYYY, –Ω–µ —Å—Ç–∞—Ä—à–µ 70 –ª–µ—Ç
- **gender** - 0, 1 –∏–ª–∏ 2

### –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è online_score:
–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –Ω–µ–ø—É—Å—Ç–∞—è –ø–∞—Ä–∞:
- phone + email
- first_name + last_name
- gender + birthday

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã)
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–±–æ–∏—Ö –º–µ—Ç–æ–¥–æ–≤
- –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π: –∞–¥–º–∏–Ω –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç score = 42

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
hm_4/
‚îú‚îÄ‚îÄ api.py          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å API –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ scoring.py      # –§—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–æ—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
‚îú‚îÄ‚îÄ test.py         # Unit-—Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ pyproject.toml  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ README.md       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **HTTP –∑–∞–ø—Ä–æ—Å** –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ `/method`
2. **–ü–∞—Ä—Å–∏–Ω–≥ JSON** –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
3. **–°–æ–∑–¥–∞–Ω–∏–µ MethodRequest** –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –ø–æ–ª–µ–π
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω
5. **–†–æ—É—Ç–∏–Ω–≥** –∫ –Ω—É–∂–Ω–æ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É –ø–æ –ø–æ–ª—é `method`
6. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ Request** (OnlineScore –∏–ª–∏ ClientsInterests)
7. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤** —á–µ—Ä–µ–∑ Field-–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã
8. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** (—Ä–∞—Å—á–µ—Ç —Å–∫–æ—Ä–∞ –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤)
9. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞** –≤ JSON

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–ú–µ—Ç–∞–∫–ª–∞—Å—Å** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∞—Å—Å–∞
- **–î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã** –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **DRY –ø—Ä–∏–Ω—Ü–∏–ø** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ Field
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –ø–æ–ª–µ–π –∏–ª–∏ –º–µ—Ç–æ–¥—ã API

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

–≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –û–û–ü –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤. –í production —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –§—Ä–µ–π–º–≤–æ—Ä–∫–∏ (FastAPI, Django REST)
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (Pydantic, Marshmallow)
- –ù–æ—Ä–º–∞–ª—å–Ω—É—é –ë–î –≤–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–µ–∫ –≤ scoring.py
- JWT —Ç–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç—ã—Ö —Ö–µ—à–µ–π